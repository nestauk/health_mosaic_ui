<script>
  import { Results, ResultsItem } from '../components/Results';
  import QueryManager from '../components/QueryManager.svelte';

  import { searchStore, searchMachine } from '../machines/search.ts';
  import { screenStore, currentTab } from '../stores/search.ts'
  let tab = 0;

  $: data = $screenStore[$currentTab].results.data

  function deleteResults({detail}) {
    searchStore.update(s => ({
      ...s,
      data: {
        ...s.data,
        [detail.removed]: []
      }
    }));
    tab=detail.tab
  }


</script>

<svelte:head>
  <title>Search</title>
</svelte:head>

<QueryManager on:tab="{(e) => tab = e.detail}"
              on:deletetab="{deleteResults}" />

<div class="content">
  <!-- {#if data && $searchStore.data[tab] && $searchStore.data[tab].length } -->

    <Results dirty={!!$searchMachine.dirty}>
      {#each data as data }
        <ResultsItem {data}></ResultsItem>
      {/each}
    </Results>
  <!-- {/if} -->
</div>

