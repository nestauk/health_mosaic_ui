<script>
  import { Results } from '../components/Results';
  import QueryManager from '../components/QueryManager.html';

  import { searchStore, searchMachine } from '../machines/search.ts';

  let tab = 0;

  function deleteResults({detail}) {
    searchStore.update(s => ({
      ...s,
      data: {
        ...s.data,
        [detail.removed]: []
      }
    }));
    tab=detail.tab
  }

</script>

<svelte:head>
  <title>Search</title>
</svelte:head>

<QueryManager
  on:tab="{(e) => tab = e.detail}"
  on:deletetab="{deleteResults}"
/>

<div>
  {#if $searchStore.data && $searchStore.data[tab] && $searchStore.data[tab].length}
    <Results
      results="{$searchStore.data[tab]}"
      dirty="{!!$searchMachine.dirty}"
    />
  {/if}
</div>


